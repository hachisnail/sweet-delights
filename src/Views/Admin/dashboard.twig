{% extends "Layouts/admin.twig" %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <div class="flex flex-col md:flex-row justify-between md:items-center gap-4 mb-6">
    <h2 class="text-3xl font-bold text-[#835234]">{{ title }}</h2>
  </div>

  {# --- 1. Stat Cards (Unchanged) --- #}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    
    <div class="bg-white p-6 rounded-lg shadow-md shadow-gray-400 border border-gray-200">
      <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total Revenue</h3>
      <p class="text-3xl font-bold text-pink-600 mt-2">‚Ç±{{ stats.revenue|number_format(2) }}</p>
      <p class="text-xs text-gray-400 mt-1">From completed orders</p>
    </div>
    
    <div class="bg-white p-6 rounded-lg shadow-md shadow-gray-400 border border-gray-200">
      <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total Orders</h3>
      <p class="text-3xl font-bold text-[#835234] mt-2">{{ stats.total_orders }}</p>
      <p class="text-xs text-gray-400 mt-1">All-time placed orders</p>
    </div>
    
    <div class="bg-white p-6 rounded-lg shadow-md shadow-gray-400 border border-gray-200">
      <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Pending Orders</h3>
      <p class="text-3xl font-bold text-yellow-600 mt-2">{{ stats.pending_orders }}</p>
      <p class="text-xs text-gray-400 mt-1">Awaiting processing</p>
    </div>
    
    <div class="bg-white p-6  rounded-lg shadow-md shadow-gray-400 border border-gray-200">
      <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total Customers</h3>
      <p class="text-3xl font-bold text-[#835234] mt-2">{{ stats.customers }}</p>
      <p class="text-xs text-gray-400 mt-1">Registered customer accounts</p>
    </div>
  </div>

  {# --- 2. NEW: Chart Grid --- #}
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
    
    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md shadow-gray-400 border border-gray-200">
      <h3 class="text-xl font-semibold text-[#a07445] mb-4">Sales (Last 7 Days)</h3>
      <div class="h-64">
        <canvas id="salesChart"></canvas>
      </div>
    </div>
    
    <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md shadow-gray-400 border border-gray-200">
      <h3 class="text-xl font-semibold text-[#a07445] mb-4">Order Statuses</h3>
      <div class="h-64">
        <canvas id="orderStatusChart"></canvas>
      </div>
    </div>

  </div>
  {# --- END NEW --- #}


  {# --- 3. Data Lists (Unchanged) --- #}
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    
    <div class="bg-white rounded-lg shadow-md shadow-gray-400 border border-gray-200">
      <div class="p-4 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-xl font-semibold text-[#a07445]">Recent Pending Orders</h3>
        <a href="{{ app_url }}/app/orders?status=Processing" class="text-sm text-pink-600 hover:underline">View All</a>
      </div>
      <div class="divide-y divide-gray-200">
        {% for order in recent_orders %}
          <div class="p-4 flex justify-between items-center hover:bg-gray-50 transition">
            <div>
              <a href="{{ app_url }}/app/orders/{{ order.id }}" class="font-medium text-pink-700 hover:underline">Order #{{ order.id }}</a>
              <p class="text-sm text-gray-500">by {{ order.customer_name }} on {{ order.date|date("M j, Y") }}</p>
            </div>
            <div class="text-right">
              <span class="font-semibold text-gray-800">‚Ç±{{ order.total|number_format(2) }}</span>
            </div>
          </div>
        {% else %}
          <div class="p-6 text-center text-gray-500">
            <p>No pending orders. Great job! ‚ú®</p>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-md shadow-gray-400 border border-gray-200">
      <div class="p-4 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-xl font-semibold text-[#a07445]">Low Stock Items</h3>
        <a href="{{ app_url }}/app/products" class="text-sm text-pink-600 hover:underline">View All</a>
      </div>
      <div class="divide-y divide-gray-200">
        {% for product in low_stock_items %}
          <div class="p-4 flex justify-between items-center hover:bg-gray-50 transition">
            <div>
              <a href="{{ app_url }}/app/products/{{ product.id }}/edit" class="font-medium text-pink-700 hover:underline">{{ product.name }}</a>
              <p class="text-sm text-gray-500">{{ product.sku }}</p>
            </div>
            <div class="text-right">
              <span class="font-bold text-yellow-600">{{ product.stock }}</span>
              <span class="text-sm text-gray-500">in stock</span>
            </div>
          </div>
        {% else %}
          <div class="p-6 text-center text-gray-500">
            <p>No items are running low on stock. üëç</p>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

{# --- 4. NEW: Chart.js Script --- #}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    
    // --- Sales Line Chart ---
    const salesCtx = document.getElementById('salesChart');
    if (salesCtx) {
      new Chart(salesCtx, {
        type: 'line',
        data: {
          labels: {{ chart_data.sales_labels|raw }},
          datasets: [{
            label: 'Total Sales (‚Ç±)',
            data: {{ chart_data.sales_values|raw }},
            fill: true,
            borderColor: 'rgb(219, 39, 119)', // pink-600
            backgroundColor: 'rgba(219, 39, 119, 0.1)',
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    // --- Order Status Doughnut Chart ---
    const statusCtx = document.getElementById('orderStatusChart');
    if (statusCtx) {
      new Chart(statusCtx, {
        type: 'doughnut',
        data: {
          labels: {{ chart_data.status_labels|raw }},
          datasets: [{
            label: 'Order Statuses',
            data: {{ chart_data.status_values|raw }},
            backgroundColor: [
              'rgb(234, 179, 8)',  // yellow-500 (Processing)
              'rgb(59, 130, 246)', // blue-500 (Shipped)
              'rgb(22, 163, 74)',  // green-600 (Delivered)
              'rgb(220, 38, 38)'   // red-600 (Cancelled)
            ],
            hoverOffset: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false
        }
      });
    }

  });
</script>
{% endblock %}